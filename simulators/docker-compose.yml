services:
  device_agent:
    image: spaneng/doover_device_agent:apps
    network_mode: host

  platform_iface:
    image: spaneng/doover_platform_iface
    network_mode: host
    restart: unless-stopped
    entrypoint: python3 -u platform_iface.py --type=sim


  flow_meter_simulator:
    build: flow_meter_sim
    network_mode: host
    restart: unless-stopped
    depends_on:
      platform_iface:
        condition: service_healthy
    #   # device_agent:
    #   #   condition: service_healthy
      
    environment:
      - APP_KEY=sim_app_key
      - HEALTHCHECK_PORT=49201
      # - DDA_URI=192.168.0.53:50051

  flow_pulse_counter:
    build: ../
    network_mode: host
    restart: unless-stopped
    depends_on:
      device_agent:
        condition: service_healthy
      platform_iface:
        condition: service_healthy
      flow_meter_simulator:
        condition: service_healthy
    environment:
      - APP_KEY=test_app_key
      - CONFIG_FP=/app/simulators/app_config.json
      - HEALTHCHECK_PORT=49202
      # - DDA_URI=192.168.0.53:50051
    # volumes:
      # - ./app_config.json:/app/app_config.json
      # - /etc/localtime:/etc/localtime:ro